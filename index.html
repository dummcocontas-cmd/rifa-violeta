<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Solid√°ria da Violeta üê∂üíñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAyH2AaRqpmJkVJDOao-svlqOEcCWhfOAw",
            authDomain: "rifa-violeta.firebaseapp.com",
            projectId: "rifa-violeta",
            storageBucket: "rifa-violeta.firebasestorage.app",
            messagingSenderId: "791676617355",
            appId: "1:791676617355:web:8beeb1f41d6b71e08bca8e"
        };

        const WHATSAPP = '5514997432961';
        const PIX = '14 99743-2961';
        const META = 6880;

        let state = {
            numeros: {},
            carrinho: [],
            view: 'home',
            stats: { disponiveis: 300, reservados: 0, pagos: 0 },
            mostrarCarrinho: false
        };

        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                onSnapshot(collection(db, 'numeros'), (snapshot) => {
                    if (!snapshot.empty) {
                        const dados = {};
                        snapshot.forEach((doc) => {
                            dados[doc.id] = doc.data();
                        });
                        state.numeros = dados;
                        calculateStats();
                        render();
                    }
                });
            } catch (error) {
                console.log('Modo offline');
                initLocal();
            }
        }

        function initLocal() {
            for (let i = 1; i <= 300; i++) {
                state.numeros[i] = { status: 'disponivel' };
            }
            calculateStats();
            render();
        }

        function calculateStats() {
            state.stats = { disponiveis: 0, reservados: 0, pagos: 0 };
            Object.values(state.numeros).forEach(num => {
                if (num.status === 'disponivel') state.stats.disponiveis++;
                else if (num.status === 'reservado') state.stats.reservados++;
                else if (num.status === 'pago') state.stats.pagos++;
            });
        }

        function getCorStatus(status) {
            if (status === 'disponivel') return 'bg-green-500 hover:bg-green-600 cursor-pointer';
            if (status === 'reservado') return 'bg-yellow-500 cursor-not-allowed';
            if (status === 'pago') return 'bg-blue-500 cursor-not-allowed';
        }

        function handleNumeroClick(numero) {
            const numeroData = state.numeros[numero];
            if (numeroData?.status !== 'disponivel') return;
            
            if (state.carrinho.includes(numero)) {
                state.carrinho = state.carrinho.filter(n => n !== numero);
            } else {
                state.carrinho.push(numero);
            }
            render();
        }

        function removerDoCarrinho(numero) {
            state.carrinho = state.carrinho.filter(n => n !== numero);
            render();
        }

        function copiarPix() {
            navigator.clipboard.writeText(PIX).then(() => {
                const feedback = document.getElementById('pix-copiado');
                if (feedback) {
                    feedback.style.opacity = '1';
                    setTimeout(() => {
                        feedback.style.opacity = '0';
                    }, 2000);
                }
            });
        }

        function finalizarCompra() {
            if (state.carrinho.length === 0) {
                alert('Adicione pelo menos um n√∫mero ao carrinho!');
                return;
            }
            
            const numerosOrdenados = [...state.carrinho].sort((a, b) => a - b);
            const total = state.carrinho.length * 20;
            const mensagem = `Oi! Quero participar da Rifa Solid√°ria da Violeta üíúüíú\n\nEscolhi ${state.carrinho.length} n√∫mero(s): ${numerosOrdenados.join(', ')}\n\nTotal: R$ ${total.toLocaleString('pt-BR')}\n\nEu j√° mando o pagamento!`;
            window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(mensagem)}`, '_blank');
            state.carrinho = [];
            state.mostrarCarrinho = false;
            render();
        }

        function renderHome() {
            const progressoPercent = Math.min((state.stats.pagos * 20 / META) * 100, 100);
            
            return `
                <div class="min-h-screen bg-pink-50">
                    <div class="bg-white shadow-md">
                        <div class="container mx-auto px-4 py-6">
                            <h1 class="text-4xl font-bold text-center text-gray-800" style="font-family: cursive">
                                Rifa Solid√°ria
                            </h1>
                            <div class="w-32 mx-auto border-t-2 border-gray-800 mt-2"></div>
                        </div>
                    </div>

                    <div class="container mx-auto px-4 py-8 max-w-4xl">
                        <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
                            <div class="flex flex-col md:flex-row gap-6 items-center">
                                <div class="w-32 h-32 rounded-full flex-shrink-0 overflow-hidden border-4 border-pink-300 shadow-lg">
                                    <img 
                                        src="https://raw.githubusercontent.com/dummcocontas-cmd/meusite/refs/heads/main/assets/ll.jpeg" 
                                        alt="Foto da Violeta"
                                        class="w-full h-full object-cover"
                                    />
                                </div>
                                <div class="flex-1 text-center md:text-left">
                                    <h2 class="text-2xl font-bold text-gray-800 mb-3">Ajude a Violeta</h2>
                                    <p class="text-gray-700 leading-relaxed">
                                        A Violeta √© uma cachorrinha SRD, que ap√≥s sofrer um ato de crueldade (ser atropelada e abandonada)
                                        Teve uma fratura grave na coluna e foi diagnosticada tamb√©m com doen√ßa do carrapato üíî<br>

                                        Para que ela possa se recuperar e voltar a andar, teve que fazer uma cirurgia delicada, est√° fazendo um tratamento, e est√° tomando alguns rem√©dios, e tudo ter√° um custo de aproximadamente <strong class="text-pink-600">R$ 6.880,00</strong>.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-white rounded-xl shadow-md p-4 text-center">
                                <div class="text-2xl font-bold text-green-600">${state.stats.disponiveis}</div>
                                <div class="text-xs text-gray-600">Dispon√≠veis</div>
                            </div>
                            <div class="bg-white rounded-xl shadow-md p-4 text-center">
                                <div class="text-2xl font-bold text-yellow-600">${state.stats.reservados}</div>
                                <div class="text-xs text-gray-600">Reservados</div>
                            </div>
                            <div class="bg-white rounded-xl shadow-md p-4 text-center">
                                <div class="text-2xl font-bold text-blue-600">${state.stats.pagos}</div>
                                <div class="text-xs text-gray-600">Pagos</div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                            <div class="flex justify-between text-sm text-gray-600 mb-2">
                                <span class="font-bold text-pink-600">R$ ${(state.stats.pagos * 20).toLocaleString('pt-BR')}</span>
                                <span>Meta: R$ ${META.toLocaleString('pt-BR')}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div class="bg-pink-600 h-4 rounded-full transition-all" style="width: ${progressoPercent}%"></div>
                            </div>
                        </div>

                        <div class="bg-pink-600 text-white rounded-xl shadow-md p-6 mb-6 text-center">
                            <p class="text-sm mb-2">Valor por n√∫mero</p>
                            <p class="text-3xl font-bold mb-4">R$ 20,00</p>
                            <p class="text-sm mb-3">Chave Pix:</p>
                            <button 
                                onclick="copiarPix()"
                                class="bg-white text-pink-600 font-bold px-6 py-3 rounded-lg hover:bg-pink-50 transition-all flex items-center gap-2 mx-auto"
                            >
                                <span>üìã</span>
                                <span id="pix-texto">${PIX}</span>
                            </button>
                            <p id="pix-copiado" class="text-xs mt-2 opacity-0 transition-opacity">‚úì Copiado!</p>
                        </div>

                        <button onclick="state.view = 'numeros'; render()" class="w-full bg-pink-600 text-white font-bold py-4 rounded-xl shadow-md hover:bg-pink-700 transition-all">
                            üéØ Escolher N√∫meros
                        </button>
                    </div>
                </div>
            `;
        }

        function renderNumeros() {
            let numerosHTML = '';
            for (let i = 1; i <= 300; i++) {
                const numero = state.numeros[i];
                const disponivel = numero?.status === 'disponivel';
                const noCarrinho = state.carrinho.includes(i);
                const corClass = noCarrinho ? 'bg-pink-600 ring-2 ring-pink-800' : getCorStatus(numero?.status || 'disponivel');
                
                numerosHTML += `
                    <button 
                        onclick="handleNumeroClick(${i})"
                        ${!disponivel ? 'disabled' : ''}
                        class="${corClass} text-white font-bold py-2 text-sm transition-all transform ${disponivel ? 'hover:scale-110' : 'opacity-60'}"
                    >
                        ${i}
                    </button>
                `;
            }

            let carrinhoModal = '';
            if (state.mostrarCarrinho) {
                carrinhoModal = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-end md:items-center justify-center z-50">
                        <div class="bg-white rounded-t-2xl md:rounded-2xl w-full md:max-w-md max-h-[80vh] overflow-hidden">
                            <div class="p-6 border-b flex items-center justify-between">
                                <h2 class="text-xl font-bold text-gray-800">Meu Carrinho</h2>
                                <button onclick="state.mostrarCarrinho = false; render()" class="text-gray-600 hover:text-gray-800 text-2xl">‚úï</button>
                            </div>
                            
                            <div class="p-6 overflow-y-auto max-h-[50vh]">
                                ${state.carrinho.length === 0 ? 
                                    '<p class="text-center text-gray-500 py-8">Nenhum n√∫mero selecionado</p>' :
                                    state.carrinho.sort((a, b) => a - b).map(num => `
                                        <div class="flex items-center justify-between bg-pink-50 p-3 rounded-lg mb-2">
                                            <span class="font-bold text-gray-800">N√∫mero ${num}</span>
                                            <div class="flex items-center gap-3">
                                                <span class="text-pink-600 font-bold">R$ 20,00</span>
                                                <button onclick="removerDoCarrinho(${num})" class="text-red-500 hover:text-red-700 text-xl">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                    `).join('')
                                }
                            </div>

                            ${state.carrinho.length > 0 ? `
                                <div class="p-6 border-t">
                                    <div class="flex justify-between mb-4 text-lg font-bold">
                                        <span>Total:</span>
                                        <span class="text-pink-600">R$ ${(state.carrinho.length * 20).toLocaleString('pt-BR')}</span>
                                    </div>
                                    <button onclick="finalizarCompra()" class="w-full bg-pink-600 text-white font-bold py-4 rounded-xl hover:bg-pink-700 transition-all">
                                        Enviar para WhatsApp
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            return `
                <div class="min-h-screen bg-pink-50">
                    <div class="bg-white shadow-md sticky top-0 z-10">
                        <div class="container mx-auto px-4 py-4">
                            <div class="flex items-center justify-between">
                                <button onclick="state.view = 'home'; render()" class="text-pink-600 hover:text-pink-800 font-semibold">
                                    ‚Üê Voltar
                                </button>
                                <h1 class="text-2xl font-bold text-gray-800">Escolha seus n√∫meros</h1>
                                <button onclick="state.mostrarCarrinho = true; render()" class="relative bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700">
                                    üõí
                                    ${state.carrinho.length > 0 ? `<span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold">${state.carrinho.length}</span>` : ''}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="container mx-auto px-4 py-6">
                        <div class="bg-white rounded-lg shadow-md p-3 mb-4 flex gap-4 justify-center text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 bg-green-500 rounded"></div>
                                <span>Dispon√≠vel</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded"></div>
                                <span>Reservado</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 bg-blue-500 rounded"></div>
                                <span>Pago</span>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-md p-4">
                            <div class="grid grid-cols-10 gap-1">
                                ${numerosHTML}
                            </div>
                        </div>
                    </div>

                    ${carrinhoModal}
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = state.view === 'home' ? renderHome() : renderNumeros();
        }

        window.handleNumeroClick = handleNumeroClick;
        window.removerDoCarrinho = removerDoCarrinho;
        window.finalizarCompra = finalizarCompra;
        window.copiarPix = copiarPix;
        window.state = state;
        window.render = render;

        window.onload = () => initFirebase();
    </script>
</body>
</html>